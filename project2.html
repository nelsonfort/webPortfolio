<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-en="Compact Battery PCB - My Portfolio" data-es="PCB Batería Compacta - Mi Portafolio">PCB Batería Compacta - Mi Portafolio</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <div class="container">
            <h1 class="logo-text" data-en="Nelson Fortunatti" data-es="Nelson Fortunatti">Nelson Fortunatti</h1>
            <button class="nav-toggle" aria-label="toggle navigation" aria-expanded="false">
                <span class="hamburger"></span>
            </button>
            <ul id="primary-navigation">
                <li><a href="index.html#cover" data-en="Home" data-es="Inicio">Inicio</a></li>
                <li><a href="index.html#about" data-en="About Me" data-es="Sobre Mí">Sobre Mí</a></li>
                <li><a href="index.html#projects" data-en="Projects" data-es="Proyectos">Proyectos</a></li>
                <li><a href="index.html#contact" data-en="Contact" data-es="Contacto">Contacto</a></li>
                <li id="lang-switcher"><a href="#">English</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <section class="project-detail-section">
            <div class="container">
                <h2 data-en="Compact 6s Smart Battery PCB" data-es="PCB para Batería Inteligente 6s Compacta">PCB para Batería Inteligente 6s Compacta</h2>

                <div class="carousel-container">
                    <div class="carousel-slides">
                        <div class="carousel-slide" style="background-image: url('images/project2/img1.jpg');"></div>
                        <div class="carousel-slide" style="background-image: url('images/project2/img2.jpg');"></div>
                        <div class="carousel-slide" style="background-image: url('images/project2/img3.jpg');"></div>
                        <div class="carousel-slide" style="background-image: url('images/project2/img4.jpg');"></div>
                        <div class="carousel-slide" style="background-image: url('images/project2/img5.jpg');"></div>
                        <div class="carousel-slide" style="background-image: url('images/project2/img6.jpg');"></div>
                        <div class="carousel-slide" style="background-image: url('images/project2/img7.jpg');"></div>
                        <div class="carousel-slide" style="background-image: url('images/project2/img8.jpg');"></div>
                    </div>
                </div>

                <div class="project-detail-description">
                    <h3 data-en="About This Project" data-es="Sobre Este Proyecto">Sobre Este Proyecto</h3>
                    <p data-en="Following the validation on the development board, this project focused on creating a compact, multi-PCB solution for the 6s smart battery system. The design is split across three interconnected boards: a main MCU/I/O board, a power stage board, and a cell interconnection/monitoring board. This modular approach allows for a smaller overall footprint and optimized layout for thermal management and signal integrity." data-es="Tras la validación en la placa de desarrollo, este proyecto se centró en crear una solución compacta multi-PCB para el sistema de batería inteligente 6s. El diseño se divide en tres placas interconectadas: una placa principal de MCU/E/S, una placa de etapa de potencia y una placa de interconexión/monitoreo de celdas. Este enfoque modular permite un tamaño total reducido y una disposición optimizada para la gestión térmica y la integridad de la señal.">Following the validation on the development board, this project focused on creating a compact, multi-PCB solution for the 6s smart battery system. The design is split across three interconnected boards: a main MCU/I/O board, a power stage board, and a cell interconnection/monitoring board. This modular approach allows for a smaller overall footprint and optimized layout for thermal management and signal integrity.</p>
                    <p data-en="The cell interconnection board is crucial for physically connecting the individual battery cells while also providing voltage sensing points for the monitoring and balancing circuits. The power stage board houses the high-current MOSFETs and protection components in a compact area, designed to dissipate heat effectively. The MCU board integrates the microcontroller, communication interfaces, and other low-power components, acting as the 'brain' of the smart battery system." data-es="La placa de interconexión de celdas es crucial para conectar físicamente las celdas individuales de la batería, al tiempo que proporciona puntos de detección de voltaje para los circuitos de monitoreo y balanceo. La placa de etapa de potencia aloja los MOSFETs de alta corriente y los componentes de protección en un área compacta, diseñada para disipar el calor de manera efectiva. La placa del MCU integra el microcontrolador, las interfaces de comunicación y otros componentes de bajo consumo, actuando como el 'cerebro' del sistema de batería inteligente.">The cell interconnection board is crucial for physically connecting the individual battery cells while also providing voltage sensing points for the monitoring and balancing circuits. The power stage board houses the high-current MOSFETs and protection components in a compact area, designed to dissipate heat effectively. The MCU board integrates the microcontroller, communication interfaces, and other low-power components, acting as the 'brain' of the smart battery system.</p>
                    <h3 data-en="Key Aspects:" data-es="Aspectos Clave:">Aspectos Clave:</h3>
                    <ul>
                        <li data-en="Multi-board design for miniaturization." data-es="Diseño multi-placa para miniaturización.">Diseño multi-placa para miniaturización.</li>
                        <li data-en="Optimized layout for thermal and electrical performance." data-es="Diseño optimizado para rendimiento térmico y eléctrico.">Diseño optimizado para rendimiento térmico y eléctrico.</li>
                        <li data-en="Integration of cell-level monitoring and balancing." data-es="Integración de monitoreo y balanceo a nivel de celda.">Integración de monitoreo y balanceo a nivel de celda.</li>
                    </ul>
                     </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p><span data-en="&copy; 2025 Nelson Fortunatti. All rights reserved." data-es="&copy; 2025 Nelson Fortunatti. Todos los derechos reservados.">&copy; 2025 Nelson Fortunatti. Todos los derechos reservados.</span></p>
            <p><span data-en="nelsonfortunatti@gmail.com" data-es="nelsonfortunatti@gmail.com">nelsonfortunatti@gmail.com</span></p>
        </div>
    </footer>

    <div id="imageModal" class="modal">
        <span class="close-modal">&times;</span>
        <a class="prev-modal">&#10094;</a>
        <img class="modal-content" id="modalImage">
        <a class="next-modal">&#10095;</a>
        <div id="caption"></div>
    </div>
    <script>
         document.addEventListener('DOMContentLoaded', () => {
            // --- Hamburger Navigation Toggle ---
            const navToggle = document.querySelector('.nav-toggle');
            const primaryNav = document.getElementById('primary-navigation');

            if (navToggle && primaryNav) {
                navToggle.addEventListener('click', () => {
                    primaryNav.classList.toggle('nav-ul-active');
                    navToggle.classList.toggle('is-active');

                    // ARIA attribute for accessibility
                    const isExpanded = primaryNav.classList.contains('nav-ul-active');
                    navToggle.setAttribute('aria-expanded', isExpanded);
                });

                // Optional: Close menu when a navigation link is clicked (useful for single-page anchors)
                const navLinks = primaryNav.querySelectorAll('a');
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        // Check if the menu is open (especially relevant for mobile)
                        if (window.innerWidth <= 768 && primaryNav.classList.contains('nav-ul-active')) {
                            primaryNav.classList.remove('nav-ul-active');
                            navToggle.classList.remove('is-active');
                            navToggle.setAttribute('aria-expanded', 'false');
                        }
                    });
                });
            }

            // --- Language Switcher Script ---
            const htmlTag = document.documentElement;
            const langSwitcherListItem = document.getElementById('lang-switcher'); // Get the LI
            let langSwitcherLink = null;
            if (langSwitcherListItem) {
                langSwitcherLink = langSwitcherListItem.querySelector('a'); // Get the A inside LI
            }
            const elementsToTranslate = document.querySelectorAll('[data-en], [data-es], [data-en-placeholder], [data-es-placeholder]');
            const titleTag = document.querySelector('title');

            function setLanguage(lang) {
                htmlTag.lang = lang;
                localStorage.setItem('lang', lang);

                if (langSwitcherLink) { // Check if link exists
                    if (lang === 'es') {
                        langSwitcherLink.textContent = 'English';
                    } else {
                        langSwitcherLink.textContent = 'Español';
                    }
                }

                if (titleTag) { // Check if titleTag exists
                    const titleEn = titleTag.getAttribute('data-en');
                    const titleEs = titleTag.getAttribute('data-es');
                    if (lang === 'en' && titleEn) {
                        titleTag.textContent = titleEn;
                    } else if (lang === 'es' && titleEs) {
                        titleTag.textContent = titleEs;
                    }
                }


                elementsToTranslate.forEach(element => {
                    const textEn = element.getAttribute('data-en');
                    const textEs = element.getAttribute('data-es');
                    if (lang === 'en' && textEn !== null) {
                        element.textContent = textEn;
                    } else if (lang === 'es' && textEs !== null) {
                        element.textContent = textEs;
                    }

                    const placeholderEn = element.getAttribute('data-en-placeholder');
                    const placeholderEs = element.getAttribute('data-es-placeholder');
                    if (lang === 'en' && placeholderEn !== null) {
                        element.placeholder = placeholderEn;
                    } else if (lang === 'es' && placeholderEs !== null) {
                        element.placeholder = placeholderEs;
                    }
                });
            }

            const savedLang = localStorage.getItem('lang');
            if (savedLang) {
                setLanguage(savedLang);
            } else {
                setLanguage(htmlTag.lang || 'es'); // Default to 'es' if not set, or to HTML lang attr
            }

            if (langSwitcherLink) { // Check if link exists
                langSwitcherLink.addEventListener('click', (event) => {
                    event.preventDefault();
                    const currentLang = htmlTag.lang;
                    const newLang = currentLang === 'es' ? 'en' : 'es';
                    setLanguage(newLang);
                });
            }

            // --- Carousel Script (Only runs if carousel elements are present) ---
            const carouselSlidesContainer = document.querySelector('.carousel-slides');
            if (carouselSlidesContainer) {
                const slides = document.querySelectorAll('.carousel-slide');
                const intervalTime = 3000;
                let slideInterval;
                let currentIndex = 0;

                if (slides.length > 0) {
                    function moveCarouselTo(index) {
                        currentIndex = index;
                        const offset = -currentIndex * 100;
                        carouselSlidesContainer.style.transform = `translateX(${offset}%)`;
                    }

                    function nextSlide() {
                        currentIndex++;
                        if (currentIndex >= slides.length) {
                            currentIndex = 0;
                        }
                        moveCarouselTo(currentIndex);
                    }

                    slideInterval = setInterval(nextSlide, intervalTime);

                    const carouselContainer = carouselSlidesContainer.parentElement;
                    if (carouselContainer) {
                        carouselContainer.addEventListener('mouseenter', () => {
                            clearInterval(slideInterval);
                        });

                        carouselContainer.addEventListener('mouseleave', () => {
                            slideInterval = setInterval(nextSlide, intervalTime);
                        });
                    }
                    moveCarouselTo(0); // Initialize carousel position
                }
            }

            // --- Image Modal Script (Only runs if modal elements are present) ---
            const modal = document.getElementById("imageModal");
            if (modal) {
                modal.style.display = "none"; // Ensure it's hidden initially
                const modalImg = document.getElementById("modalImage");
                const prevModalButton = document.querySelector(".prev-modal");
                const nextModalButton = document.querySelector(".next-modal");
                // const captionText = document.getElementById("caption"); // Uncomment if you implement captions

                let currentModalImageIndex = 0;
                let carouselImageSources = [];

                // Collect image sources from carousel slides if they exist
                const allCarouselSlidesForModal = document.querySelectorAll('.carousel-slide');
                allCarouselSlidesForModal.forEach(slide => {
                    let style = window.getComputedStyle(slide);
                    let bgImage = style.getPropertyValue('background-image');
                    if (bgImage && bgImage !== 'none') {
                        const urlMatch = bgImage.match(/url\(["']?(.*?)["']?\)/);
                        if (urlMatch && urlMatch[1]) {
                            carouselImageSources.push(urlMatch[1]);
                        }
                    }
                });

                function showImageInModal(index) {
                    if (carouselImageSources.length === 0 || !modalImg) return;

                    currentModalImageIndex = index;
                    // Loop around if index goes out of bounds
                    if (currentModalImageIndex < 0) {
                        currentModalImageIndex = carouselImageSources.length - 1;
                    } else if (currentModalImageIndex >= carouselImageSources.length) {
                        currentModalImageIndex = 0;
                    }
                    modalImg.src = carouselImageSources[currentModalImageIndex];
                    // if (captionText) { captionText.innerHTML = allCarouselSlidesForModal[currentModalImageIndex].getAttribute('data-caption') || ''; }
                }

                allCarouselSlidesForModal.forEach((slide, index) => {
                    slide.onclick = function(){
                        if (modalImg && carouselImageSources.length > 0) {
                            modal.style.display = "flex"; // Use flex for centering
                            showImageInModal(index);
                        }
                    }
                });

                if (prevModalButton) {
                    prevModalButton.onclick = function() { showImageInModal(currentModalImageIndex - 1); }
                }
                if (nextModalButton) {
                    nextModalButton.onclick = function() { showImageInModal(currentModalImageIndex + 1); }
                }

                const closeModalButton = document.querySelector(".close-modal");
                if (closeModalButton) {
                    closeModalButton.onclick = function() { modal.style.display = "none"; }
                }

                window.onclick = function(event) {
                    if (event.target == modal) { modal.style.display = "none"; }
                }

                document.addEventListener('keydown', function(event) {
                    if (modal.style.display === "flex") { // Check if modal is active
                        if (event.key === "ArrowLeft" && prevModalButton) prevModalButton.click();
                        else if (event.key === "ArrowRight" && nextModalButton) nextModalButton.click();
                        else if (event.key === "Escape" && closeModalButton) closeModalButton.click();
                    }
                });
            }
        });
     </script>

</body>
</html>           // }
            }

            allCarouselSlides.forEach((slide, index) => {
                slide.onclick = function(){
                    if (modal && modalImg && carouselImageSources.length > 0) {
                        modal.style.display = "block";
                        showImageInModal(index);
                    }
                }
            });

            // Added click handlers for the new modal buttons
            if (prevModalButton) {
                prevModalButton.onclick = function() {
                    currentModalImageIndex--;
                    if (currentModalImageIndex < 0) {
                        currentModalImageIndex = carouselImageSources.length - 1;
                    }
                    showImageInModal(currentModalImageIndex);
                }
            }

            if (nextModalButton) {
                nextModalButton.onclick = function() {
                    currentModalImageIndex++;
                    if (currentModalImageIndex >= carouselImageSources.length) {
                        currentModalImageIndex = 0;
                    }
                    showImageInModal(currentModalImageIndex);
                }
            }

            const closeModalButton = document.querySelector(".close-modal");
            if (closeModalButton && modal) {
                closeModalButton.onclick = function() {
                    modal.style.display = "none";
                }
            }

            window.onclick = function(event) {
                if (event.target == modal && modal) {
                    modal.style.display = "none";
                }
            }

            // Optional: Add keyboard navigation for arrows when modal is open
            document.addEventListener('keydown', function(event) {
                if (modal && modal.style.display === "block") {
                    if (event.key === "ArrowLeft") {
                        if (prevModalButton) prevModalButton.click();
                    } else if (event.key === "ArrowRight") {
                        if (nextModalButton) nextModalButton.click();
                    } else if (event.key === "Escape") {
                        if (closeModalButton) closeModalButton.click();
                    }
                }
            });
        });
     </script>

</body>
</html>